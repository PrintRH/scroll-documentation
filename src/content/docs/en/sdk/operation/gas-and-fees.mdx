---
section: sdk
title: "Gas & Fee Management in Scroll SDK"
lang: "en"
permalink: "sdk/operation/gas-and-fees"
excerpt: "Learn more about gas and fee management in Scroll SDK"
---

import Aside from "../../../../../components/Aside.astro"

Scroll SDK provides a comprehensive gas and fee management system to ensure the efficient operation of the network. This section provides an overview of the gas and fee management tools and best practices for using them.

## Configuring Transaction Fees on an SDK Chain

Transaction fees for users on Scroll are split between an L2 Fee and an L1 Fee. For more information on how transaction fees, see [Transaction Fees on Scroll](/en/developers/transaction-fees-on-scroll).

### Configuring L2 Fees

Most L2 fees are set as a minimum "floor", beyond which normal mechanisms for EIP1559 adjustment apply. Network fees are placed in the L2FeeVault contract, and can be claimed by the Owner role.

This is set with `--miner.gasprice` on the sequencer. You can modify this value and `--gpo.ignoreprice` in the chart by overriding the `L2GETH_MIN_GAS_PRICE` environment variable [here](https://github.com/scroll-tech/scroll-sdk/blob/main/charts/l2-sequencer/values.yaml#L106).

Additionally, you could modify the `--gpo.percentile` and `--gpo.blocks` arguements, but will need to manually modify the `l2-sequencer` chart. 

Lastly, RPC nodes (or any node that accepts transactions) should set `--gpo.congestionthreshold`, which we default to 500. This configuration allows nodes to provide more accurate fee estimate. The value is the number of pending transactions to consider the network congested and suggest a minimum tip cap if there are fewer pending transactions in the txpool.[^congestion-threshold]

[^congestion-threshold]: See these [`l2geth` code comments](https://github.com/scroll-tech/go-ethereum/blob/develop/eth/gasprice/gasprice.go#L197) for more info.

For additional information, see the [geth documentation](https://geth.ethereum.org/docs/fundamentals/command-line-options).

### Configuring L1 Fees

The L1GasOracle pre-deployed contract holds the values used to calculate the L1 fee for transactions.

The following fields are set by the Gas Oracle service, specifically by transactions submitted by the `L2GasOracleSender`:
- `l1BaseFee`: the base fee for the L1 transaction
- `l1BlobBaseFee`: the base fee for the L1 blob data

The following fields are set by the Owner using setter functions in the `L1GasOracle` contract:
- `commitScalar`
- `blobScalar`
- `overhead`
- `scalar`

To see these on Scroll's mainnet deployment, view the [L1GasOracle contract](https://scrollscan.com/address/0x5300000000000000000000000000000000000002#writeContract).


## Alternative Gas Token

Beyond the default gas token, Scroll SDK also supports alternative gas tokens. This customization allows users to use their preferred gas token for transactions.

### Calculating and Setting Gas Oracle Fields

On Scroll, transaction fees are calculated by not just charging a gas fee, but also an L1 fee. Because the conversion needed between the L1's native token and the SDK's gas token, additional configuration and logic is needed.

Instead of introducing another variable to the L1GasPriceOracle contract, operators should incorporate the ETH/ERC20 conversion rate into the calculation of the "scalar".

For more information on how gas fees on Scroll are calculated, see the [Calculating the L1 Data Fee with Gas Oracle](/en/developers/transaction-fees-on-scroll/#calculating-the-l1-data-fee-with-gas-oracle).

<Aside type="caution">
We're currently working on tooling to help operators calculate and automate updates to the scalar, using trading prices from both centralized exchange and Uniswap Pools.
</Aside>

<Aside type="danger">
Currently, we recommend setting the scalar value to 0. See [Disable L1 Data Fee](/en/sdk/guides/digital-ocean-alt-gas-token/#disable-l1-data-fee) in the example deployment guide for more information.
</Aside>

## Claiming Fees from the Vault

As L2 Fees accumulate in the L2FeeVault, any user can call the `withdrawl` method to "claim" these fees. This will bridge the funds to the `L1_FEE_VAULT_ADDR` address (configured in `config.toml`) on the L1 chain.

After the funds are bridged, the bridged funds will still need to be claimed on L1 with a proof that can be easily obtained using the `bridge-history-api`. To see this process on Scroll, see [Finalizing Transactions on L1](/en/developers/l1-and-l2-bridging/the-scroll-messenger/#finalizing-transactions-on-l1)

<Aside type="tip">
We'll likely add these steps to the CLI or Admin System Dashboard in the future.
</Aside>

# Setting scalars & additional gas oracle configuration

## Set scalars

On contract `L1GasPriceOracle` , there are two variables `commitScalar` and `blobScalar` . which are used to calculate L1 fee for a L1 transaction.

### Calculate scalars

```jsx
// fixed values
compression_ratio = 2.887
blob_util_ratio = 87.1%

// formula to calculate scalars
// tx_per_block: average transaction number per L2 block
// tx_per_batch: average transaction number per batch
// fluctuation_multiplier: multiplier used to pervent loss from transaction number and L1 gas price fluctuation
commitScalar = (1382.58 / tx_per_block + 71621.32 / tx_per_batch)  * fluctuation_multiplier * 1e9
blobScalar = fluctuation_multiplier / compression_ratio / blob_util_ratio * 1e9 
```

### Set scalars to contract L1GasPriceOracle

cast command to set scalars.

```jsx
cast send --rpc-url <l2_rpc_url> 0x5300000000000000000000000000000000000002 "setCommitScalar(uint256)" <commitScalar> --private-key <owner_private_key>
cast send --rpc-url <l2_rpc_url> 0x5300000000000000000000000000000000000002 "setBlobScalar(uint256)" <blobScalar> --private-key <owner_private_key>
```

## Configuring Gas Oracle

For more complicated configurations, you'll want to make manual adjustments to the gas oracle config, specifically the `alternative_gas_token_config` sections.

```json
// L1 gas oracle config
"gas_oracle_config": {
  "min_gas_price": 0,
  "gas_price_diff": 50000,
  "l1_base_fee_weight": 0.132,
  "l1_blob_base_fee_weight":  0.145,
  "check_committed_batches_window_minutes": 5,
  "l1_base_fee_default": 15000000000,
  "l1_blob_base_fee_default": 1,
  "alternative_gas_token_config": {
    "enabled": false,
    "mode": "BinanceAp",
    "fixed_exchange_rate": 0.001,
    "token_symbol_pair": "UNIETH"
  }
}

// L2 gas oracle config
"gas_oracle_config": {
  "min_gas_price": 0,
  "gas_price_diff": 50000,
  "alternative_gas_token_config": {
    "enabled": false,
    "mode": "BinanceAp",
    "fixed_exchange_rate": 0.001,
    "token_symbol_pair": "UNIETH"
  }
},
```

### L1 gas oracle config

- `min_gas_price`: the minimal gas price set to contract L1GasPriceOracle. (for both baseFee and blobBaseFee)
- `gas_price_diff`: the minimum percentage of gas price difference to update gas oracle. (for both baseFee and blobBaseFee)
- `l1_base_fee_weight`: the weight for L1 base fee. **(deprecated after curie upgrade)**
- `l1_blob_base_fee_weight` : the weight for L1 blob base fee. **(deprecated after curie upgrade)**
- `check_committed_batches_window_minutes` : the time frame to check if we committed batches to decide to update gas oracle or not in minutes. If we are not committing batches due to high fees then we shouldn't update fees to prevent users from paying high l1_data_fee, so we should set fees to some default value. **(set it  to the same or slightly larger value as batch_timeout_sec, note: don’t forget convert second to minute).**
- `l1_base_fee_default` : the default base cost value set when a batch is not committed for longer than check_committed_batches_window_minutes.
- `l1_blob_base_fee_default` :  the default blob base cost value set when a batch is not committed for longer than check_committed_batches_window_minutes.
- `alternative_gas_token_config` :
    - `enabled` : if include L2/L1 gas token exchange rate into gas price. (should only set to true when alternative gas token enabled)
    - `mode` : the mode to retrieve L2/L1 gas token exchange rate. (now we only support mode `Fixed` and `BinanceApi`)
    - `fixed_exchange_rate` : effect only when mode is `Fixed`, it represents the number of native token on L1 required to exchange for 1 native token on L2.
    - `token_symbol_pair` : effect only when mode is `BinanceApi`,  The pair should be L2 gas token symbol + L1 gas token symbol. For instance if we use Uni token as gas token on L2, the pair should be “UNIETH”. (check token pair support by Binance [here](https://api.binance.com/api/v3/ticker/price))

### L2 gas oracle config

- `min_gas_price`: the minimal gas price set to contract L1GasPriceOracle.
- `gas_price_diff`: the minimum percentage of gas price difference to update gas oracle.
- `alternative_gas_token_config` : refer to `alternative_gas_token_config` on L1 gas oracle config above.